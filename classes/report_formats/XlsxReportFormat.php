<?php
class XlsxReportFormat extends ReportFormatBase {	public static function display(&$report, &$request) {		// First let set up some headers		$file_name = preg_replace(array('/[\s]+/','/[^0-9a-zA-Z\-_\.]/'),array('_',''),$report->options['Name']);		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');		header('Content-Disposition: attachment;filename="'.$file_name.'.xlsx"');		header('Pragma: no-cache');		header('Expires: 0');		//always use cache for Excel reports		$report->use_cache = true;		//run the report		$report->run();		if(!$report->options['Rows']) return;		// Create new PHPExcel object		$objPHPExcel = new PHPExcel();		// Set document properties		$objPHPExcel->getProperties()->setCreator("PHP-Reports")									 ->setLastModifiedBy("PHP-Reports")									 ->setTitle("")									 ->setSubject("")									 ->setDescription("");		$rows = array(); $i = 0;		$first_row = $report->options['Rows'][0];		foreach($first_row['values'] as $key=>$value){			error_log("Rows: ".var_export($value->key, true));			$rows[0][$i++] = $value->key;		}		$objPHPExcel->setActiveSheetIndex(0)->fromArray($rows, NULL, 'A1');		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');		$objWriter->save('php://output');	}}