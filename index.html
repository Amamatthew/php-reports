<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Php Reports</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Php Reports - a PHP framework for displaying reports from any data source, including SQL and MongoDB">
    <meta name="author" content="Jeremy Dorn">

    <!-- Le styles -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
      section:before {
	display:block; 
	content:""; 
	height:50px; 
	margin:-50px 0 0; 
      }
      #screenshots {
	-moz-box-shadow: 0 0 5px 5px #aaa;
	-webkit-box-shadow: 0 0 5px 5px #aaa;
	box-shadow: 0 0 5px 5px #aaa;
      }
    </style>
    <link href="css/bootstrap-responsive.min.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
  </head>

  <body data-spy="scroll" data-target="#sidenav" data-offset="50">
    <!-- Fork Me on Github ribbon -->
    <a href="https://github.com/jdorn/php-reports" style="position: fixed; top: 0; right: 0; z-index: 9999;"><img src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png" alt="Fork me on GitHub"></a>

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="brand" href="http://jdorn.github.com/php-reports/">Php Reports</a>
          <a href="https://github.com/jdorn/php-reports/archive/master.zip" class="btn btn-primary pull-left">
	    <i class='icon-download icon-white'></i>
	    Download ZIP
	  </a>
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span3" data-spy="affix" id="sidenav">
          <div class="well sidebar-nav">
            <ul class="nav nav-list">
              <li><a href="#about">About</a></li>
	      <li><a href="#getting_started">Getting Started</a></li>
              <li>
                <a href="#configuration">Configuration</a>
                <ul class="nav nav-list">
		  <li><a href="#basic_settings">Basic Settings</a></li>
		  <li><a href="#email_settings">Email Settings</a></li>
		  <li><a href="#environments_and_databases">Environments and Databases</a></li>
		</ul>
	      </li>
	      <li>
		<a href="#report_types">Report Types</a>
		  <ul class="nav nav-list">
		    <li><a href="#mysql">MySQL</a></li>
		    <li><a href="#mongodb">MongoDB</a></li>
		    <li><a href="#php">PHP</a></li>
		    <li><a href="#custom_types">Custom Types</a></li>
		  </ul>
	      </li>
	      <li>
		<a href="#report_headers">Report Headers</a>
		  <ul class="nav nav-list">
		    <li><a href="#variables">Variables</a></li>
		    <!--
		    <li><a href="#charts">Charts</a></li>
		    <li><a href="#options">Options</a></li>
		    <li><a href="#rollups">Rollups</a></li>
		    -->
		  </ul>
	      </li>
            </ul>
          </div><!--/.well -->
        </div><!--/span-->
        <div class="offset3">
	  <h1>Php Reports</h1>
	  
	  <p>A framework for displaying reports from any data source, including SQL and MongoDB.</p>
	  
	  <div id="screenshots" class="carousel slide">
	    <!-- Carousel items -->
	    <div class="carousel-inner">
	      <div class="active item">
		<img src="img/report-table-screenshot.png" />
		<div class='carousel-caption'>
		  <h4>Beautiful Reports in a Variety of Formats</h4>
		  <p>
		    View your reports in the browser or export to a number of different formats, including CSV, JSON, and XML.
		  </p>
		</div>
	      </div>
	      <div class="item">
		<img src="img/configure-report-screenshot.png" />
		<div class='carousel-caption'>
		  <h4>Customize Your Reports</h4>
		  <p>
		    Add report parameters that are passed directly into the report body.
		  </p>
		</div>
	      </div>
	      <div class="item">
		<img src="img/report-list-screenshot.png" />
		<div class='carousel-caption'>
		  <h4>Organize and Manage Your Reports</h4>
		  <p>
		    Easily keep track of hundreds or even thousands of reports with a heirarchical report list and typeahead search.
		  </p>
		</div>
	      </div>
	      <div class="item">
		<img src="img/report-chart-screenshot.png" />
		<div class='carousel-caption'>
		  <h4>Report Charts and Graphs</h4>
		  <p>
		    Add charts or graphs easily to any report using Google's Data Visualization API.
		  </p>
		</div>
	      </div>
	      <div class="item">
		<img src="img/editor-screenshot.png" />
		<div class='carousel-caption'>
		  <h4>Easy to Learn</h4>
		  <p> 
		    No proprietary report language.  Write MySQL reports in SQL, MongoDB reports in Javascript, and PHP reports in PHP.
		  </p>
		</div>
	      </div>
	    </div>
	    <!-- Carousel nav -->
	    <a class="carousel-control left" href="#screenshots" data-slide="prev">&lsaquo;</a>
	    <a class="carousel-control right" href="#screenshots" data-slide="next">&rsaquo;</a>
	  </div>
	  	
	  <section id="about">
	    <h2>About</h2>
	    
	    <p>
	      Php Reports simplifies managing and displaying database reports.  
	    </p>
	    
	    <p>
	      You write reports in SQL, javascript, or PHP (depending on the data source)
	      and organize them however you like in a directory structure.  
	      Php Reports takes care of the rest.
	    </p>

	    <p>Major features include:</p>

	    <ul>
	      <li>Display a report from any data source that can output tabular data (SQL, MongoDB, PHP, etc.)</li>
	      <li>Output reports in HTML, XML, CSV, JSON, or your own custom format</li>
	      <li>Add customizable parameters to a report (e.g. date range, keyword, etc.)</li>
	      <li>Support for graphs and charts with the Google Data Visualization API</li>
	      <li>Easily switch between database environments (e.g. Production, Staging, and Dev)</li>
	      <li>Fully extendable and customizable</li>
	    </ul>
	  </section>
	  <section id="getting_started">
	    <h2>Getting Started</h2>
	    
	    <p>
	      Php Reports requires PHP 5.3, Apache or nginx, and a modern browser.  
	      You'll also need MySQL and/or MongoDB plus their respective PHP extensions if you want to use those report types.
	    </p>
	    
	    <p>The easiest way to start using Php Reports is to clone the git repo.</p>
	    
	    <pre>git clone git://github.com/jdorn/php-reports.git</pre>
	    
	    <p>
	      You can also download a pre-packaged 
	      <a href="https://github.com/jdorn/php-reports/zipball/master">zip</a> or 
	      <a href="https://github.com/jdorn/php-reports/tarball/master">tar</a> archive
	    </p>
	    
	    <p>A sample configuration is included in <code>config/config.php.sample</code>.  It's easiest to just use this as a base.</p>
	    
	    <pre>
cd php-reports
cp config/config.php.sample config/config.php</pre>

	    <p>You should now be able to view the report list in your browser</p>
	    
	    <div class='alert alert-info'>
	      If you use nginx, place the following in your server declaration - <code>try_files $uri $uri/ /index.php;</code>
	    </div>
	    
	  </section>
	  <section id="configuration">
	    <h2>Configuration</h2>
	    
	    <p>This section describes the different configuration settings.</p>
	    
	    <section id="basic_settings">
	      <h3>Basic Settings</h3>
	      
	      <p><strong>reportDir</strong> is the path to the directory containing all of your report files. It is relative to the project's root.</p>
	      
	      <p>
		<strong>cacheDir</strong> is the path to the cache directory.  
		This directory needs write access.  
		Some relatively long term data is stored here, so using <code>/tmp</code> is not recommended.
		This is also relative to the project's root.
	      </p>
	      
	      <p>
		<strong>default_file_extension_mapping</strong> defines the default file extensions for different report types.  Here is an example:
	      </p>
	      <pre>array(
	'sql'=>'Mysql',
	'php'=>'Php',
	'js'=>'Mongo'
)</pre>
	      <p><em>*Note</em> - This mapping can be overridden on a report-by-report basis if needed.</p>
	    </section>
	    <section id="email_settings">
	      <h3>Email Settings</h3>
	      
	      <p>
		On each report, there is an "Email Report" button.  
		For this to work, an outgoing mail server needs to be set up.
		Here are the basic mail settings:
	      </p>
	      
	      <pre>'email_settings'=>array(
  'enabled'=>true,
  'from'=>'reports@yourdomain.com'
)</pre>
	      <p>There are 3 different methods you can use to send email.</p>
	      
	      <p><strong>mail</strong> - use PHP's <code>mail</code> function.  This is the simplest method if your server is configured for it.</p>
	      <pre>'email_settings'=>array(
  'enabled'=>true,
  'from'=>'reports@yourdomain.com',
  'method'=>'mail'
)</pre>

	      <p><strong>sendmail</strong> - use your system's <code>sendmail</code> command.</p>
	      <pre>'email_settings'=>array(
  'enabled'=>true,
  'from'=>'reports@yourdomain.com',
  'method'=>'sendmail',
  'command'=>'/usr/sbin/sendmail -bs'
)</pre>
	      
	      <p><strong>smtp</strong> - use an SMTP server.  This is the most complex and flexible method.  Here is a simple example:</p>
	      <pre>'email_settings'=>array(
  'enabled'=>true,
  'from'=>'reports@yourdomain.com',
  'method'=>'smtp',
  'server'=>'smtp.yourdomain.com',
  'port'=>25
)</pre>

	    <p>You can also specify encryption and a username and password if needed.  Here is an example for using Gmail:</p>
	      <pre>'email_settings'=>array(
  'enabled'=>true,
  'from'=>'youremail@gmail.com',
  'method'=>'smtp',
  'server'=>'smtp.gmail.com',
  'port'=>465,
  'username'=>'youremail@gmail.com',
  'password'=>'yourpassword',
  'encryption'=>'ssl'
)</pre>	      
	    </section>
	    <section id="environments_and_databases">
	      <h3>Environments and Databases</h3>
	      
	      <p>This is where you define the data sources the reports pull from.</p>
	      
	      <p>Php Reports supports multiple environments (e.g. "Production" and "Staging") and allows users to switch between them easily.</p>
	      
	      <p>
		Within each environment, you define the database connection info.  
		You can have as many different databases as you want.  
		Here is an example:
	      </p>
	      
	      <pre>'environments'=>array(
  'production'=>array(
    'mysql'=>array(
      'host'=>'mysql.yourdomain.com',
      'user'=>'readonly',
      'pass'=>'password',
      'database'=>'test'
    ),
    'mongo'=>array(
      'host'=>'mongodb.yourdomain.com',
      'port'=>'27017'
    )
  )
)</pre>

	      <p>It is recommended to use readonly database users whenever possible to protect against possible database corruption.</p>
	      
	    </section>
	  </section>
	  
	  <section id="report_types">
	    <h2>Report Types</h2>
	    
	    <p>Out of the box, Php Reports supports Mysql, MongoDB, and PHP data sources.  It's also easy to add your own custom format.</p>
	    
	    <section id="mysql">
	      <h3>MySQL Reports</h3>
	      
	      <p>
		MySQL reports consist of 1 or more SQL statements separated by semicolons.
		The result of the last statement is used for the report.
		At the top of the report is a comment block with name, description, and any other report headers you need.
	      </p>
	      
	      <p>
		All MySQL reports are parsed with the Twig templating language before running.
	      </p>
	      
	      <pre>
-- My Report
-- This lists all the products that cost
-- more than a given price.
-- VARIABLE: { name: "min_price", display: "Minimum Price" }

SELECT Name, Price FROM Products WHERE Price > "{{ min_price }}"</pre>

	      <p>Variables and all the other headers you can use are covered in detail in the <a href="#report_headers">Report Headers</a> section.</p>
	    </section>
	    
	    <section id="mongodb">
	      <h3>MongoDB Reports</h3>
	      
	      <p>MongoDB reports consist of a javascript file that is run in the MongoDB Shell and outputs an array of JSON objects.  Here is an example:</p>
	      
	      <pre>
// My Other Report
// Lists all food products in a MongoDB collection
// MONGODATABASE: MyDatabase
// VARIABLE: { name: "active_only", display: "Active Items Only?", type: "select", options: ["yes","no"] }

var query = {type: 'food'};

if(active_only == 'yes') {
    query.status = 'active';
}

var result = db.FoodItems.find(query);

printjson(result);</pre>

	    </section>
	    
	    <section id="php">
	      <h3>PHP Reports</h3>
	      
	      <p>
		You can also write reports using PHP.  
		PHP reports must output JSON data, just like MongoDB reports above.
	      </p>
	      
	      <p>
		Writing reports in PHP is especially useful for fetching data from APIs or doing complex data processing that is out of the scope of SQL.
		Here is an example:
	      </p>
	      
	      <pre>
&lt;?php
//My Third Report
//This connects to the Stripe Payments api and shows a list of charges
//VARIABLE: { name: "count", display: "Number of Charges" }

if($count &gt; 100 || $count &lt; 1) throw new Exception("Number of Charges must be between 1 and 100");

require_once("/path/to/Stripe/Stripe.php");

$charges = Stripe_Charge::all(array("count" =&gt; $count));

$rows = array();
foreach($charges as $charge) {
    $rows[] = array(
        'Charge Id'=&gt;$charge-&gt;id,
        'Amount'=&gt;number_format($charge-&gt;amount/100,2),
        'Date'=&gt;date('Y-m-d',$charge-&gt;created)
    );
}

echo json_encode($rows);
?&gt;</pre>
	    </section>
	    
	    <section id="custom_types">
	      <h3>Custom Report Types</h3>
	      
	      <p>
		Adding your own report type is easy.  
		Report Type classes extend <strong>ReportTypeBase</strong> and live in <code>classes/report_types/</code>.  
		You can also place them in <code>classes/local/report_types/</code> if you want them ignored by git.
	      </p>
	      
	      <p>
		The existing report type classes are well commented and are the best place to start when making your own.
	      </p>
	    </section>
	  </section>
	  
	  <section id="report_headers">
	    <h2>Report Headers</h2>
	    
	    <p>
	      At the top of every report in a block of comments containing name, description, 
	      and various headers that alter the appearance or behavior in some way.
	    </p>
	    
	    <p>
	      The first header line is always the report name.  Then comes an optional description followed by any named headers.
	    </p>
	    
	    <div class='alert alert-info'>
	      There must be a blank line between the headers and the report.
	    </div>
	    
	    <pre>
-- This is the Report Name
-- This is a report description
-- that can be on multiple lines
-- HEADERNAME: This is a named header

SELECT * FROM MyTable;</pre>
	    
	    <p>
	      For full documentation, see the wiki at 
	      <a href="https://github.com/jdorn/php-reports/wiki/Report-Headers">
		https://github.com/jdorn/php-reports/wiki/Report-Headers
	      </a>
	    </p>
	    
	    <section id="variables">
	      <h3>Variable Header</h3>
	      <p>
		This header adds a "Configure Report" section to the top of the report with parameters you specify.  
		These parameters are passed into the report as variables.
	      </p>
	      
	      <table class='table table-bordered table-striped'>
		<thead>
		  <tr>
		    <th>Parameter Name</th>
		    <th>Type</th>
		    <th>Description</th>
		    <th>Default Value</th>
		  </tr>
		</thead>
		<tbody>
		  <tr>
		    <td>database_options</td>
		    <td>object</td>
		    <td>
		      If type is "select", this tells the framework to populate the drop down list from the database.  It has the following properties:
		      <ul>
			<li><strong>table</strong> - The database table to select from</li>
			<li><strong>column</strong> - The column to select for the value</li>
			<li><strong>where</strong> - An optional WHERE clause</li>
			<li><strong>all</strong> - If set to true, an addional option named "ALL" will be added to the top of the list.</li>
		      </ul>
		    </td>
		    <td><code>null</code></td>
		  </tr>
		  <tr>
		    <td>default</td>
		    <td>mixed</td>
		    <td>
		      The default value for the variable.  Will be pre-populated when the report is opened.
		    </td>
		    <td><code>null</code></td>
		  </tr>
		  <tr>
		    <td>description</td>
		    <td>string</td>
		    <td>
		      Add an optional description for this variable.  This shows up as help text in the "Configure Report" section.
		    </td>
		    <td><code>null</code></td>
		  </tr>
		  <tr>
		    <td>display</td>
		    <td>string</td>
		    <td>The display name of the variable.  This is shown to the user in the Configure Report section.  If this isn't set, the variable name will be used.</td>
		    <td><code>null</code></td>
		  </tr>
		  <tr>
		    <td>empty</td>
		    <td>boolean</td>
		    <td>
		      If true, the report will run even if the value is empty.
		    </td>
		    <td><code>false</code></td>
		  </tr>
		  <tr>
		    <td>format</td>
		    <td>string</td>
		    <td>
		      If type is "date" or "daterange", this specifies the date format to convert to before passing into the report.  Format follows PHP's date methods.  This options will be ignored for all other types.
		    </td>
		    <td>
		      <code>"Y-m-d H:i:s"</code>
		    </td>
		  </tr>
		  <tr>
		    <td>modifier_options</td>
		    <td>array</td>
		    <td>
		      Adds a modifier dropdown before the input with the specified options.  Common values are ["=","!=","&gt;","&lt;"] or ["starts with","ends with","contains"].  Passed into the report as a variable named {{name}}_modifier.
		    </td>
		    <td><code>null</code></td>
		  </tr>
		  <tr>
		    <td>multiple</td>
		    <td>boolean</td>
		    <td>
		      If true and type is "select", the input will change to a multi-select box and the value will be an array.
		      If true and type is "textarea", the input will be split by linebreaks and the value will be an array.
		      This option is ignored for all other types.
		    </td>
		    <td><code>false</code></td>
		  </tr>
		  <tr>
		    <td>name</td>
		    <td>string</td>
		    <td>The name of the variable when it's passed into the report.  Must be a valid variable name (i.e. no spaces or weird punctuation)</td>
		    <td><code>null</code></td>
		  </tr>
		  <tr>
		    <td>options</td>
		    <td>array or object</td>
		    <td>
		      If type is "select", these are the options that populate the select box.
		      Can be an array or object with key value pairs.
		      If type is anything other than "select", this option is ignored.
		    </td>
		    <td><code>[]</code></td>
		  </tr>
		  <tr>
		    <td>type</td>
		    <td>string</td>
		    <td>The type of variable.  Valid types are "text", "select", "textarea", "date", and "daterange".</td>
		    <td><code>"text"</code></td>
		  </tr>
		</tbody>
	      </table>
		      
	      <pre>VARIABLE: { name: "userid", display: "User Id" }</pre>
	      
	      <pre>
VARIABLE: { 
  name: "category", 
  display: "Category", 
  type: "select", 
  options: ["Reptile","Mammal","Dinosaur"] 
}</pre>

	      <pre>VARIABLE: { name: "start", display: "Start Date", type: "date", format: "F j, Y" }</pre>

	      <pre>
VARIABLE: {
    "name": "range",
    "type": "daterange",
    "default": {
        "start": "-1 week",
        "end": "now"
    }
}</pre>   
	    </section> <!--/variable header-->
	    
	  </section>
	  
        </div><!--/span-->
      </div><!--/row-->

      <hr>

      <footer>
        <p>Php Reports - <a href='http://jdorn.github.com/php-reports/'>http://jdorn.github.com/php-reports/</a></p>
      </footer>

    </div><!--/.fluid-container-->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="js/jquery-1.8.3.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script>
      $(document).ready(function() {
	  $('body').scrollspy('refresh');
      });
    </script>

  </body>
</html>
